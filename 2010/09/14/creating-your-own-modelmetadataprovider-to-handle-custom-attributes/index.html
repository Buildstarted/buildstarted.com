<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Creating your own modelmetadataprovider to handle custom attributes &#8211; BuildStarted.com</title>
    <link rel="stylesheet" type="text/css" href="../../../../stylesheets/style.css" />
</head>
<body class="home blog">
    <div id="page" class="hfeed site">
        <header id="masthead" class="site-header" role="banner">
            <hgroup>
                <a class="site-logo" href="../../../../index.html" title="BuildStarted.com" rel="home">
                    <img src="http://gravatar.com/avatar/b94abfe0e3e68e2d739c606ee6f2b7b4/?s=100&#038;d=mm" alt="BuildStarted.com" width="100" height="100" class="no-grav"></a>
                <h1 class="site-title"><a href="../../../../index.html" title="BuildStarted.com" rel="home">BuildStarted.com</a></h1>
                <h2 class="site-description">Newly minted father. C# dev that enjoys playing around with random ideas.</h2>
            </hgroup>
            <nav role="navigation" class="site-navigation main-navigation">
                <h1 class="assistive-text">Menu</h1>
                <div class="assistive-text skip-link"><a href="index.html#content" title="Skip to content">Skip to content</a></div>
                <div class="menu">
                    <ul>
                        <li class="page_item page-item-2"><a href="../../../../about/index.html">About</a></li>
                    </ul>
                </div>
            </nav>
        </header>
        <div id="main">
            <div id="primary" class="site-content">
                <div id="content" role="main">
                    <div id="post">
    <h1>Creating your own modelmetadataprovider to handle custom attributes</h1>

    <p>I&rsquo;ve answered a couple questions recently about using the DescriptionAttribute from the System.ComponentModel namespace, as well as creating your own Attributes and using them in HtmlHelpers. I&rsquo;ve answered each one individually to answer the specific questions with very specific answers to each one. But it got me thinking that MVC has a way to override just about everything and doubtless the MetadataProvider was one of them. A quick search of the code available at <a href='http://aspnet.codeplex.com/'>codeplex</a> lead me to the <strong>ModelMetadataProviders</strong>.</p>

<p>I&rsquo;m going to create a new class based on the <strong>DataAnnotationsModelMetadataProvider</strong> since I use this particular provider a lot.</p>

<pre><code>public class CustomModelMetadataProvider : DataAnnotationsModelMetadataProvider {
    protected override ModelMetadata CreateMetadata(
                             IEnumerable&lt;Attribute&gt; attributes,
                             Type containerType,
                             Func&lt;object&gt; modelAccessor,
                             Type modelType,
                             string propertyName) {

        var data = base.CreateMetadata(
                             attributes, 
                             containerType, 
                             modelAccessor, 
                             modelType, 
                             propertyName);

        return data;
    }
}
</code></pre>

<p>Simple and to the point. Now how do we access the System.ComponentModel.DescriptionAttribute. Well, luckily for us, the attributes parameter of CreateMetadata provides us with all the attributes assigned to our particular property we&rsquo;re attempting to get data for. Since attributes is IEnumerable we can use linq to find a particular attribute.</p>

<pre><code>protected override ModelMetadata CreateMetadata(
                             IEnumerable&lt;Attribute&gt; attributes,
                             Type containerType,
                             Func&lt;object&gt; modelAccessor,
                             Type modelType,
                             string propertyName) {
    var data = base.CreateMetadata(attributes,
                             containerType,
                             modelAccessor,
                             modelType,
                             propertyName);

    var description = attributes
                .SingleOrDefault(a =&gt; typeof(DescriptionAttribute) == a.GetType());
    if (description != null) data
                .Description = ((DescriptionAttribute)description).Description;

    return data;
}
</code></pre>

<p>This is great. This will take care of old code that relies on the old DescriptionAttribute rather than the new DataAnnotations DisplayAttribute(Description=&ldquo;&rdquo;). What if we wanted to add our own custom information to the ModelMetadata? Well the MVC team has graciously provided us with an <strong>AdditionalValues</strong> property to the ModelMetadata. In this example I&rsquo;m going to make a tooltip attribute for the title attribute of an html element.</p>

<pre><code>protected override ModelMetadata CreateMetadata(
                             IEnumerable&lt;Attribute&gt; attributes, 
                             Type containerType, 
                             Func&lt;object&gt; modelAccessor, 
                             Type modelType, 
                             string propertyName) {
    var data = base.CreateMetadata(attributes,
                              containerType, 
                             modelAccessor, 
                             modelType, 
                             propertyName);

    var tooltip = attributes
                .SingleOrDefault(a =&gt; typeof(TooltipAttribute) == a.GetType());
    if (tooltip != null) data.AdditionalValues
                .Add("Tooltip", ((TooltipAttribute)tooltip).Tooltip);

    return data;
}
</code></pre>

<p>Same as before but instead of using an existing property of the ModelMetadata we&rsquo;re adding a key/value pair to the AdditionalValues property.</p>

<h2>Using our new-found powers for awesome</h2>

<p>So how do we use this new found ability? First we&rsquo;re going to set the current provider to our new provider by adding this to our global.asax Application&#95;Start() method.</p>

<pre><code>ModelMetadataProviders.Current = new CustomModelMetadataProvider();
</code></pre>

<p>And now we&rsquo;re going to use a new HtmlHelper called ToolTipFor.</p>

<pre><code>public static IHtmlString TooltipFor&lt;TModel, TValue&gt;(
                             this HtmlHelper&lt;TModel&gt; html, 
                             Expression&lt;Func&lt;TModel, TValue&gt;&gt; expression) {
    var x = ModelMetadata.FromLambdaExpression&lt;TModel, TValue&gt;(expression, html.ViewData);
    if (x.AdditionalValues.ContainsKey("Tooltip"))
        return new HtmlString((string)x.AdditionalValues["Tooltip"]);

    return new HtmlString("");
}
</code></pre>

<p>ModelMetadata.FromLambdaExpression uses our new model provider to fill out the values and we then we check for our tooltip property. If it&rsquo;s found we return, else we return an empty string.</p>

<p>In our View we&rsquo;re going to utilize our new HtmlHelper like so:</p>

<pre><code>public class User {
    [Tooltip("Please enter your name.")]
    public string Name { get; set; }
}


@Html.TextBoxFor(m =&gt; m.Name, new { title=@Html.TooltipFor(m =&gt; m.Name)} )
</code></pre>

<p>And voila! We have a tooltip for our text input box. There are probably many more additions that can be made, such as overriding localizations. I hope this gives you a good start in how extensible MVC is.</p>

<h3>- Ben</h3>


    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'buildstarted';
        var disqus_url = "http://buildstarted.com/2010/09/14/creating-your-own-modelmetadataprovider-to-handle-custom-attributes/";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
                </div>
                <!-- #content -->
            </div>
            <!-- #primary .site-content -->

            <div id="secondary" class="widget-area" role="complementary">
                <aside id="text-5" class="widget widget_text">
                    <h1 class="widget-title">Follow</h1>
                    <div class="textwidget">
                        <a href="http://twitter.com/buildstarted" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://twitter.com']);">Twitter</a><br />
                        <a href="http://stackoverflow.com/users/365526/buildstarted" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://stackoverflow.com']);">Stackoverflow.com</a><br />
                        <a href="https://plus.google.com/118314403854065988234" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://plus.google.com']);">Google+</a><br />
                        <a href="https://github.com/Buildstarted" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://github.com']);">Github</a>
                    </div>
                </aside>
                <aside id="text-8" class="widget widget_text">
                    <h1 class="widget-title">Other sites</h1>
                    <div class="textwidget">
                        <a href="http://typescript.io/" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://typescript.io']);">typescript.io</a><br />
                        <a href="http://csharptube.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://csharptube.com']);">csharptube.com</a><br />
                        <a href="http://thisisparrot.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://thisisparrot.com']);">Parrot</a><br />
                    </div>
                </aside>
                <aside id="linkcat-6" class="widget widget_links">
                    <h1 class="widget-title">Other Blogs</h1>
                    <ul class='xoxo blogroll'>
                        <li><a href="http://blog.andrewnurse.net/" target="_top" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://blog.andrewnurse.net/']);">Andrew Nurse @ Microsoft</a></li>
                        <li><a href="http://weblogs.asp.net/jgalloway/" target="_top" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://weblogs.asp.net/jgalloway/']);">Jon Galloway @ Microsoft</a></li>
                        <li><a href="http://msmvps.com/blogs/jon_skeet/" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://msmvps.com/blogs/jon_skeet/']);">Jon Skeet</a></li>
                        <li><a href="http://invalidcast.com" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://invalidcast.com']);">Martin Rue</a></li>
                        <li><a href="http://haacked.com/" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://haacked.com/']);">Phil Haack @ Github</a></li>

                    </ul>
                </aside>
                <aside id="archives-4" class="widget widget_archive">
                    <h1 class="widget-title">Archive</h1>
                    
                    

                      <ul class="posts">
                        
                          
                          <!-- May placeholder -->
                          
                            
                            <li><a href='../../../../archive.html#2015May'>May 2015</a></li>
                          
                        
                          
                          <!-- December May -->
                          
                            
                            <li><a href='../../../../archive.html#2014December'>December 2014</a></li>
                          
                        
                          
                          <!-- December December -->
                          
                        
                          
                          <!-- June December -->
                          
                            
                            <li><a href='../../../../archive.html#2014June'>June 2014</a></li>
                          
                        
                          
                          <!-- May June -->
                          
                            
                            <li><a href='../../../../archive.html#2014May'>May 2014</a></li>
                          
                        
                          
                          <!-- January May -->
                          
                            
                            <li><a href='../../../../archive.html#2014January'>January 2014</a></li>
                          
                        
                          
                          <!-- January January -->
                          
                        
                          
                          <!-- December January -->
                          
                            
                            <li><a href='../../../../archive.html#2013December'>December 2013</a></li>
                          
                        
                          
                          <!-- December December -->
                          
                        
                          
                          <!-- June December -->
                          
                            
                            <li><a href='../../../../archive.html#2013June'>June 2013</a></li>
                          
                        
                          
                          <!-- June June -->
                          
                        
                          
                          <!-- May June -->
                          
                            
                            <li><a href='../../../../archive.html#2013May'>May 2013</a></li>
                          
                        
                          
                          <!-- February May -->
                          
                            
                            <li><a href='../../../../archive.html#2013February'>February 2013</a></li>
                          
                        
                          
                          <!-- November February -->
                          
                            
                            <li><a href='../../../../archive.html#2012November'>November 2012</a></li>
                          
                        
                          
                          <!-- September November -->
                          
                            
                            <li><a href='../../../../archive.html#2012September'>September 2012</a></li>
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- August September -->
                          
                            
                            <li><a href='../../../../archive.html#2012August'>August 2012</a></li>
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- July August -->
                          
                            
                            <li><a href='../../../../archive.html#2012July'>July 2012</a></li>
                          
                        
                          
                          <!-- July July -->
                          
                        
                          
                          <!-- June July -->
                          
                            
                            <li><a href='../../../../archive.html#2012June'>June 2012</a></li>
                          
                        
                          
                          <!-- May June -->
                          
                            
                            <li><a href='../../../../archive.html#2012May'>May 2012</a></li>
                          
                        
                          
                          <!-- February May -->
                          
                            
                            <li><a href='../../../../archive.html#2012February'>February 2012</a></li>
                          
                        
                          
                          <!-- January February -->
                          
                            
                            <li><a href='../../../../archive.html#2012January'>January 2012</a></li>
                          
                        
                          
                          <!-- January January -->
                          
                        
                          
                          <!-- December January -->
                          
                            
                            <li><a href='../../../../archive.html#2011December'>December 2011</a></li>
                          
                        
                          
                          <!-- December December -->
                          
                        
                          
                          <!-- December December -->
                          
                        
                          
                          <!-- October December -->
                          
                            
                            <li><a href='../../../../archive.html#2011October'>October 2011</a></li>
                          
                        
                          
                          <!-- August October -->
                          
                            
                            <li><a href='../../../../archive.html#2011August'>August 2011</a></li>
                          
                        
                          
                          <!-- July August -->
                          
                            
                            <li><a href='../../../../archive.html#2011July'>July 2011</a></li>
                          
                        
                          
                          <!-- July July -->
                          
                        
                          
                          <!-- June July -->
                          
                            
                            <li><a href='../../../../archive.html#2011June'>June 2011</a></li>
                          
                        
                          
                          <!-- March June -->
                          
                            
                            <li><a href='../../../../archive.html#2011March'>March 2011</a></li>
                          
                        
                          
                          <!-- January March -->
                          
                            
                            <li><a href='../../../../archive.html#2011January'>January 2011</a></li>
                          
                        
                          
                          <!-- January January -->
                          
                        
                          
                          <!-- December January -->
                          
                            
                            <li><a href='../../../../archive.html#2010December'>December 2010</a></li>
                          
                        
                          
                          <!-- November December -->
                          
                            
                            <li><a href='../../../../archive.html#2010November'>November 2010</a></li>
                          
                        
                          
                          <!-- November November -->
                          
                        
                          
                          <!-- November November -->
                          
                        
                          
                          <!-- November November -->
                          
                        
                          
                          <!-- November November -->
                          
                        
                          
                          <!-- November November -->
                          
                        
                          
                          <!-- October November -->
                          
                            
                            <li><a href='../../../../archive.html#2010October'>October 2010</a></li>
                          
                        
                          
                          <!-- October October -->
                          
                        
                          
                          <!-- September October -->
                          
                            
                            <li><a href='../../../../archive.html#2010September'>September 2010</a></li>
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- August September -->
                          
                            
                            <li><a href='../../../../archive.html#2010August'>August 2010</a></li>
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                      </ul>
                </aside>
            </div>
            <!-- #secondary .widget-area -->


        </div>
        <!-- #main -->

        <footer id="colophon" class="site-footer" role="contentinfo">
            <div class="site-info">
                Powered by <a href="https://github.com/" rel="generator">Github</a><span class="sep"> | </span>Theme: Publish by <a href="http://kovshenin.com/" rel="designer">Konstantin Kovshenin</a>.	
            </div>
            <!-- .site-info -->
        </footer>
        <!-- #colophon .site-footer -->
    </div>
    <!-- #page .hfeed .site -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src='../../../../javascripts/prettify.js' type='text/javascript'></script>
    <script type='text/javascript'>
        $(function () {
            $("pre code").parent().each(function () {
                if (!$(this).hasClass("prettyprint")) {
                    $(this).addClass("prettyprint");
                    a = true
                }
            });

            prettyPrint();
        });
    </script>
</body>
</html>
