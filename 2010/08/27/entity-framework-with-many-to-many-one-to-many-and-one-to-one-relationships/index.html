<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Entity framework with many to many one to many and one to one relationships &#8211; BuildStarted.com</title>
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css" />
</head>
<body class="home blog">
    <div id="page" class="hfeed site">
        <header id="masthead" class="site-header" role="banner">
            <hgroup>
                <a class="site-logo" href="https://buildstarted.com/" title="BuildStarted.com" rel="home">
                    <img src="https://gravatar.com/avatar/b94abfe0e3e68e2d739c606ee6f2b7b4/?s=100&#038;d=mm" alt="BuildStarted.com" width="100" height="100" class="no-grav"></a>
                <h1 class="site-title"><a href="https://buildstarted.com/" title="BuildStarted.com" rel="home">BuildStarted.com</a></h1>
                <h2 class="site-description">Newly minted father. C# dev that enjoys playing around with random ideas.</h2>
            </hgroup>
            <nav role="navigation" class="site-navigation main-navigation">
                <h1 class="assistive-text">Menu</h1>
                <div class="assistive-text skip-link"><a href="#content" title="Skip to content">Skip to content</a></div>
                <div class="menu">
                    <ul>
                        <li class="page_item page-item-2"><a href="https://buildstarted.com/about/">About</a></li>
                    </ul>
                </div>
            </nav>
        </header>
        <div id="main">
            <div id="primary" class="site-content">
                <div id="content" role="main">
                    <div id="post">
    <h1>Entity framework with many to many one to many and one to one relationships</h1>

    <h2>Child/Parent object assignments</h2>

<p>One of the more common things you&rsquo;re going to do in <strong>Entity Framework</strong> is link two objects together. In it&rsquo;s simplest form you just have to create a virtual property of the object in question within the consuming object. One of the nice things about Entity Framework is that it can handle all the mapping for you. Yay for us.</p>

<h2>Many-To-Many</h2>

<pre><code>public class DC : DbContext {
    public DbSet&lt;Student&gt; Students { get; set; }
    public DbSet&lt;Class&gt; Classes { get; set; }
}

public class Student {
    public int Id { get; set; }
    public string Name { get; set; }
    public virtual ICollection&lt;Class&gt; Classes { get; set; }
}

public class Class {
    public int Id { get; set; }
    public string Name { get; set; }
    public virtual ICollection&lt;Student&gt; Student { get; set; }
}
</code></pre>

<p>Our database is setup with the following tables. Students, Classes and Classes&#95;Student for the many-to-many mapping.</p>

<p>Here we have a student that with a list of classes and a class with a list of students. <strong>john</strong> doesn&rsquo;t have any classes assigned to him and likewise <strong>Rhyming 101</strong> has no students, yet. To add a student to a class or a class to a student we can do the following. (Assuming we have data in the database)</p>

<pre><code>rhyming101 = dc.Classes.Single(c =&gt; c.Id == 1);
john = dc.Students.Single(s =&gt; s.Id == 1);

john.Classes.Add(rhyming101);
//or
rhyming101.Students.Add(john);
</code></pre>

<p>However, suppose we&rsquo;re creating the student and we&rsquo;d like as few trips the data as possible. I would attempt the following.</p>

<pre><code>DC dc = new DC();
Student john = new Student() {
   Name = "Smith",
   Classes = new List&lt;Class&gt;() { new Class() { Id == 1 } }
};
</code></pre>

<p>The above code actually creates a new Class in the data ignoring the passed Id entirely. Which, to me, seems to be a mistake but it&rsquo;s what we&rsquo;re stuck with. We could make a call to the dc here and just grab the class by Id but that seems to be an unnecessary trip to the data.</p>

<pre><code>DC dc = new DC();
Student john = new Student() {
   Name = "Smith",
   Classes = new List&lt;Class&gt;() { dc.Classes.Single(c =&gt; c.Id == 1) }
};
</code></pre>

<p>I&rsquo;m not really sure any better way to handle this. Hopefully the comments will show a way to do it. (hint, hint)</p>

<h2>One-To-Many</h2>

<p>Teachers and Classes. In this example each teacher one class is taught by one teacher but a teacher may teach many classes (to make my life easy). So we need to setup a <strong>one-to-many</strong> relationship. We&rsquo;re going to modify our Class and create a new Teacher class.</p>

<pre><code>public class Class {
    public int Id { get; set; }
    public string Name { get; set; }
    public virtual ICollection&lt;Student&gt; Student { get; set; }
    public virtual Teacher { get; set; {
}

public class Teacher {
    public int Id { get; set; }
    public string Name { get; set; }
    public virtual ICollection&lt;Class&gt; Classes { get; set; }
}
</code></pre>

<p>Our Classes table in the database now includes an additional Teacher&#95;Id for us to map to the appropriate Teacher. Awesome, we don&rsquo;t have to keep track of it and we dont' have to include it in our model.</p>

<p>We now have a Teacher which has a collection of Classes assigned to them. There are two ways to make the assignments. One is to assign the class to the teacher by adding it to the classes and the other is to assign the teacher to the class.</p>

<pre><code>DC dc = new DC();
Teacher teacher = dc.Teachers.Single(t =&gt; t.Id == 1);
Class @class = dc.Classes.Single(c =&gt; c.Id == 1);

teacher.Classes.Add(@class);
//or
@class.Teacher = teacher;
</code></pre>

<h2>One-To-One</h2>

<p>Now, let&rsquo;s modify our Student and add a Locker. To Add a locker to a student you could do it one of two ways. Assign the student to the locker or assign the locker to the student. Our Student table now includes a foreign key to Locker&#95;Id automatically for us, in addition to the Student&#95;Id in the Locker table. Remember, this is all done behind the scenes and it isn&rsquo;t necessary to add these fields to your POCO.</p>

<pre><code>public class Student {
    public int Id { get; set; }
    public string Name { get; set; }
    public virtual ICollection&lt;Class&gt; Classes { get; set; }
    public virtual Locker Locker { get; set; }
}

public class Locker {
    public int Id { get; set; }
    public string SecretCode { get; set; }
    public virtual Student Student { get; set; }
}

Student john = new Student() {
    Name = "John"
}

Locker CA592B = new Locker() {
    Secret = "CA592B"
}

john.Locker = CA592B;
//or
CA592B.Student = john;
</code></pre>

<h2>Final</h2>

<p>Our database structure ends up with several tables, <strong>Classes</strong>, <strong>Classes&#95;Student</strong>, <strong>Lockers</strong>, <strong>Students</strong>, and <strong>Teachers</strong>. Each one has appropriate foreign keys and the Classes&#95;Students table isn&rsquo;t required to be created in POCO. This saves us a lot of hassle. Don&rsquo;t forget. Every virtual property type must have an equivalent **DbSet</strong> in the DataContext.</p>

<p>I hope this helps anyone understand how <strong>Entity Framework</strong> works a bit more.</p>

<h3>- Ben</h3>


    
</div>
                </div>
                <!-- #content -->
            </div>
            <!-- #primary .site-content -->

            <div id="secondary" class="widget-area" role="complementary">
                <aside id="text-5" class="widget widget_text">
                    <h1 class="widget-title">Follow</h1>
                    <div class="textwidget">
                        <a href="https://twitter.com/buildstarted" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','https://twitter.com']);">Twitter</a><br />
                        <a href="https://stackoverflow.com/users/365526/buildstarted" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','https://stackoverflow.com']);">Stackoverflow.com</a><br />
                        <a href="https://plus.google.com/118314403854065988234" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','https://plus.google.com']);">Google+</a><br />
                        <a href="https://github.com/Buildstarted" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','https://github.com']);">Github</a>
                    </div>
                </aside>
                <aside id="text-8" class="widget widget_text">
                    <h1 class="widget-title">Other sites</h1>
                    <div class="textwidget">
                        <a href="https://typescript.io/" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','https://typescript.io']);">typescript.io</a><br />
                        <a href="https://csharptube.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','https://csharptube.com']);">csharptube.com</a><br />
                        <a href="https://thisisparrot.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','https://thisisparrot.com']);">Parrot</a><br />
                    </div>
                </aside>
                <aside id="linkcat-6" class="widget widget_links">
                    <h1 class="widget-title">Other Blogs</h1>
                    <ul class='xoxo blogroll'>
                        <li><a href="https://blog.andrewnurse.net/" target="_top" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','https://blog.andrewnurse.net/']);">Andrew Nurse @ Microsoft</a></li>
                        <li><a href="https://weblogs.asp.net/jgalloway/" target="_top" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','https://weblogs.asp.net/jgalloway/']);">Jon Galloway @ Microsoft</a></li>
                        <li><a href="https://msmvps.com/blogs/jon_skeet/" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','https://msmvps.com/blogs/jon_skeet/']);">Jon Skeet</a></li>
                        <li><a href="https://invalidcast.com" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','https://invalidcast.com']);">Martin Rue</a></li>
                        <li><a href="https://haacked.com/" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','https://haacked.com/']);">Phil Haack @ Github</a></li>

                    </ul>
                </aside>
                <aside id="archives-4" class="widget widget_archive">
                    <h1 class="widget-title">Archive</h1>
                    
                    

                      <ul class="posts">
                        
                          
                          <!-- May placeholder -->
                          
                            
                            <li><a href='/archive#2015May'>May 2015</a></li>
                          
                        
                          
                          <!-- December May -->
                          
                            
                            <li><a href='/archive#2014December'>December 2014</a></li>
                          
                        
                          
                          <!-- December December -->
                          
                        
                          
                          <!-- June December -->
                          
                            
                            <li><a href='/archive#2014June'>June 2014</a></li>
                          
                        
                          
                          <!-- May June -->
                          
                            
                            <li><a href='/archive#2014May'>May 2014</a></li>
                          
                        
                          
                          <!-- January May -->
                          
                            
                            <li><a href='/archive#2014January'>January 2014</a></li>
                          
                        
                          
                          <!-- January January -->
                          
                        
                          
                          <!-- December January -->
                          
                            
                            <li><a href='/archive#2013December'>December 2013</a></li>
                          
                        
                          
                          <!-- December December -->
                          
                        
                          
                          <!-- June December -->
                          
                            
                            <li><a href='/archive#2013June'>June 2013</a></li>
                          
                        
                          
                          <!-- June June -->
                          
                        
                          
                          <!-- May June -->
                          
                            
                            <li><a href='/archive#2013May'>May 2013</a></li>
                          
                        
                          
                          <!-- February May -->
                          
                            
                            <li><a href='/archive#2013February'>February 2013</a></li>
                          
                        
                          
                          <!-- November February -->
                          
                            
                            <li><a href='/archive#2012November'>November 2012</a></li>
                          
                        
                          
                          <!-- September November -->
                          
                            
                            <li><a href='/archive#2012September'>September 2012</a></li>
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- August September -->
                          
                            
                            <li><a href='/archive#2012August'>August 2012</a></li>
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- July August -->
                          
                            
                            <li><a href='/archive#2012July'>July 2012</a></li>
                          
                        
                          
                          <!-- July July -->
                          
                        
                          
                          <!-- June July -->
                          
                            
                            <li><a href='/archive#2012June'>June 2012</a></li>
                          
                        
                          
                          <!-- May June -->
                          
                            
                            <li><a href='/archive#2012May'>May 2012</a></li>
                          
                        
                          
                          <!-- February May -->
                          
                            
                            <li><a href='/archive#2012February'>February 2012</a></li>
                          
                        
                          
                          <!-- January February -->
                          
                            
                            <li><a href='/archive#2012January'>January 2012</a></li>
                          
                        
                          
                          <!-- January January -->
                          
                        
                          
                          <!-- December January -->
                          
                            
                            <li><a href='/archive#2011December'>December 2011</a></li>
                          
                        
                          
                          <!-- December December -->
                          
                        
                          
                          <!-- December December -->
                          
                        
                          
                          <!-- October December -->
                          
                            
                            <li><a href='/archive#2011October'>October 2011</a></li>
                          
                        
                          
                          <!-- August October -->
                          
                            
                            <li><a href='/archive#2011August'>August 2011</a></li>
                          
                        
                          
                          <!-- July August -->
                          
                            
                            <li><a href='/archive#2011July'>July 2011</a></li>
                          
                        
                          
                          <!-- July July -->
                          
                        
                          
                          <!-- June July -->
                          
                            
                            <li><a href='/archive#2011June'>June 2011</a></li>
                          
                        
                          
                          <!-- March June -->
                          
                            
                            <li><a href='/archive#2011March'>March 2011</a></li>
                          
                        
                          
                          <!-- January March -->
                          
                            
                            <li><a href='/archive#2011January'>January 2011</a></li>
                          
                        
                          
                          <!-- January January -->
                          
                        
                          
                          <!-- December January -->
                          
                            
                            <li><a href='/archive#2010December'>December 2010</a></li>
                          
                        
                          
                          <!-- November December -->
                          
                            
                            <li><a href='/archive#2010November'>November 2010</a></li>
                          
                        
                          
                          <!-- November November -->
                          
                        
                          
                          <!-- November November -->
                          
                        
                          
                          <!-- November November -->
                          
                        
                          
                          <!-- November November -->
                          
                        
                          
                          <!-- November November -->
                          
                        
                          
                          <!-- October November -->
                          
                            
                            <li><a href='/archive#2010October'>October 2010</a></li>
                          
                        
                          
                          <!-- October October -->
                          
                        
                          
                          <!-- September October -->
                          
                            
                            <li><a href='/archive#2010September'>September 2010</a></li>
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- August September -->
                          
                            
                            <li><a href='/archive#2010August'>August 2010</a></li>
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                      </ul>
                </aside>
            </div>
            <!-- #secondary .widget-area -->


        </div>
        <!-- #main -->

        <footer id="colophon" class="site-footer" role="contentinfo">
            <div class="site-info">
                Powered by <a href="https://github.com/" rel="generator">Github</a><span class="sep"> | </span>Theme: Publish by <a href="https://kovshenin.com/" rel="designer">Konstantin Kovshenin</a>.	
            </div>
            <!-- .site-info -->
        </footer>
        <!-- #colophon .site-footer -->
    </div>
    <!-- #page .hfeed .site -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src='/javascripts/prettify.js' type='text/javascript'></script>
    <script type='text/javascript'>
        $(function () {
            $("pre code").parent().each(function () {
                if (!$(this).hasClass("prettyprint")) {
                    $(this).addClass("prettyprint");
                    a = true
                }
            });

            prettyPrint();
        });
    </script>
<script> (function() { var COLLECT_URL = "https://dna.buildstarted.com/t"; var SITE_ID = "buildstarted.com"; var GLOBAL_VAR_NAME = "__DNA__"; window[GLOBAL_VAR_NAME] = {}; window[GLOBAL_VAR_NAME].sendPageView = function() { var path = location.pathname; var referrer = document.referrer; var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);try { fetch(url, { method: "GET" }); } catch (e) { } }; window[GLOBAL_VAR_NAME].sendPageView(); })(); </script>
</body>
</html>
