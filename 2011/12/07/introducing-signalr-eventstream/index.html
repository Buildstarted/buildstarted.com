<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Introducing signalr eventstream &#8211; BuildStarted.com</title>
    <link rel="stylesheet" type="text/css" href="../../../../stylesheets/style.css" />
</head>
<body class="home blog">
    <div id="page" class="hfeed site">
        <header id="masthead" class="site-header" role="banner">
            <hgroup>
                <a class="site-logo" href="../../../../index.html" title="BuildStarted.com" rel="home">
                    <img src="http://gravatar.com/avatar/b94abfe0e3e68e2d739c606ee6f2b7b4/?s=100&#038;d=mm" alt="BuildStarted.com" width="100" height="100" class="no-grav"></a>
                <h1 class="site-title"><a href="../../../../index.html" title="BuildStarted.com" rel="home">BuildStarted.com</a></h1>
                <h2 class="site-description">Newly minted father. C# dev that enjoys playing around with random ideas.</h2>
            </hgroup>
            <nav role="navigation" class="site-navigation main-navigation">
                <h1 class="assistive-text">Menu</h1>
                <div class="assistive-text skip-link"><a href="index.html#content" title="Skip to content">Skip to content</a></div>
                <div class="menu">
                    <ul>
                        <li class="page_item page-item-2"><a href="../../../../about/index.html">About</a></li>
                    </ul>
                </div>
            </nav>
        </header>
        <div id="main">
            <div id="primary" class="site-content">
                <div id="content" role="main">
                    <div id="post">
    <h1>Introducing signalr eventstream</h1>

    <h2>SignalR.EventStream</h2>

<p>Introducing a new favorite <a href="http://nuget.org">Nuget</a> package: <a href="https://nuget.org/packages/SignalR.EventStream">SignalR.EventStream</a>.</p>

<div style="background-color: #202020; border: 4px solid #C0C0C0;border-radius: 5px 5px 5px 5px;box-shadow: 2px 2px 3px #6E6E6E;color: #E2E2E2;display: block;font: 1.5em 'andale mono','lucida console',monospace; overflow: auto; padding:15px; margin-bottom: 1.5em;"><p style="margin-bottom:0;">PM&gt; Install-Package SignalR.EventStream</p></div>


<p>This is a live feed of the visitors to this site. Leave this page open and watch the live feed. <em>Previous visitors will show up in a few seconds.</em></p>

<p><em>Sample no longer available</em></p>

<h2>SignalR.EventStream</h2>

<p>SignalR.EventStream allows users to monitor events happening on the server, live. A single call can be made on the server and propagated to any number of clients. This library leverages the power of <a href="https://nuget.org/packages/SignalR">SignalR</a> to make the client interface simple.</p>

<p>Born out of a desire to see when new users signed up on <a href='http://csharptube.com/'>http://csharptube.com/</a> without refreshing the user list and my familiarity with <a href="http://jabbr.net">Jabbr</a>.</p>

<h2>What can it be used for?</h2>

<p>Some events you might be interested in viewing live.</p>

<ol>
<li>User signups</li>
<li>Error notifications</li>
<li>Live user mapping (see above)</li>
<li>User notices such as when badges are awarded</li>
<li>Notice when customer makes a purchase</li>
<li>Update a page when a new comment is added</li>
<li>Update a vote count for rankings</li>
<li>Clearly the list is endless&hellip;</li>
</ol>


<h2>That&rsquo;s all great but what is SignalR?</h2>

<p>SignalR is a library developed by <a href="http://weblogs.asp.net/davidfowler/">David Fowler</a> and <a href="http://damianedwards.wordpress.com/">Damian Edwards</a> that allows asynchronous connections in ASP.Net that allows you to build real-time multi-user web applications. This basically means that you can <strong>execute server-side code directly from a client or execute javascript on the client directly from the server</strong>. It uses the best connection your browser can support. <a href='http://en.wikipedia.org/wiki/WebSocket'>WebSockets</a> and <a href='http://en.wikipedia.org/wiki/Push_technology#Long_polling'>LongPolling</a> with support for more coming soon.</p>

<p><img src="http://aws.buildstarted.com/signalr-traffic.png" alt="Firebug showing the long polling requests" title="Firefox with long polling in firebug" /></p>

<h2>Authorize users to view events</h2>

<p>There are two methods for streaming. One is <strong>Send(..)</strong> which sends an event to the &ldquo;authorized&rdquo; general group. The second method is <strong>SendTo(..)</strong> which sends an Event to a specific group of people.</p>

<h2>EventStream.Send</h2>

<p>The heart of this is that you should be able to send <strong>any</strong> data to the client and parse it via json. To enable this I&rsquo;m using <a href="http://nuget.org/packages/Newtonsoft.Json">Newtonsoft.Json</a> to convert objects passed into a Json string which is then sent to the client. This allows for a lot of flexibility since the client can now handle anything we want. The event type is determined from the type of object passed in - except for anonymous types. You must pass in a specific event type in order to utilize it. Normal string events are typed as &ldquo;event&rdquo;.</p>

<pre><code>public interface IEventStream
{
    void Send(string @event);
    void Send(string type, object @event); //mainly used for anonymous types
    void Send(object @event);

    void SendTo(string group, string @event);
    void SendTo(string group, object @event);
    void SendTo(string group, string type, object @event);
}
</code></pre>

<p>I throw an exception on anonymous types without a specified string type. One of the interesting gotcha&rsquo;s in c# is that there&rsquo;s no built in way to determine if a type is an anonymous one. Borrowing from another project I helped with, (<a href="https://github.com/Antaris/RazorEngine">RazorEngine</a>) I&rsquo;ve pulled in the IsAnonymousType method.</p>

<pre><code>public static bool IsAnonymousType(Type type)
{
    if (type == null)
        throw new ArgumentNullException("type");

    return (type.IsClass
            &amp;&amp; type.IsSealed
            &amp;&amp; type.BaseType == typeof(object)
            &amp;&amp; type.Name.StartsWith("&lt;&gt;", StringComparison.Ordinal)
            &amp;&amp; type.IsDefined(typeof(CompilerGeneratedAttribute), true));
}
</code></pre>

<p>This has been a very reliable way of checking whether or not a particular type is an anonymous type.</p>

<h2>Usage</h2>

<p>To send an event to the &ldquo;authorized&rdquo; group you simply make the following call.</p>

<pre><code>IEventStream EventStream = new EventStream();
EventStream.Send("A simple string message");
</code></pre>

<p>You can easily handle this in javascript.</p>

<pre><code>(function() {
    var eventStream = new EventStream().connect();
    eventStream.eventReceived = function(type, data) {
        console.log(data);
    });
})();
</code></pre>

<p>To send an event to a particular group you simply pass in the group you wish to send it to.</p>

<pre><code>IEventStream EventStream = new EventStream();
EventStream.SendTo("message-group", "A simple string message");
</code></pre>

<p>If you just wait on this page all events will be captured and alerted. For more complex data, however.</p>

<pre><code>IEventStream EventStream = new EventStream();
EventStream.Send(new UserSignup {
    Username = "Buildstarted",
    Realname = "Ben Dornis",
    BlogUrl = "http://buildstarted.com"
});
</code></pre>

<p>SignalR.EventStream automatically builds a Json string and passes it to the clients.</p>

<pre><code>(function() {
    var eventStream = new EventStream().connect();
    eventStream.eventReceived = function(type, data) {
        /* Handle this more complex object */
    });
})();
</code></pre>

<h2>Page specific sends</h2>

<p>To make things easier to update pages I&rsquo;ve added a <strong>PageStream()</strong> type in the eventStream.js. This uses the current pathname of the url as the group. You can then send events to any client currently viewing that page. This makes it really easy to add new comments or modify the rankings for a page.</p>

<pre><code>(function() {
   var pageStream = new PageStream().connect();
   pageStream.eventReceived = function(type, data) {
       //update the vote count!
   };
});

var path = new UrlHelper(ControllerContext.RequestContext).Action("index");
new EventStream().SendTo(path, "this is a page update");
</code></pre>

<p><em>I&rsquo;m looking at how to create a path from the current request easier than that and externally to a Controller. (update forthcoming).</em></p>

<p>You can use any simple javascript templating engine that handles json to automatically build an html object and insert it into the dom.</p>

<p>You can find the source for SignalR.EventStream on <a href="https://github.com/Buildstarted/SignalR.EventStream">Github</a>.</p>

<p>&ndash;&ldquo;[SignalR.EventStream] makes me want to look at SignalR&rdquo;</p>

<p><strong>-Ben Dornis</strong></p>


    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'buildstarted';
        var disqus_url = "http://buildstarted.com/2011/12/07/introducing-signalr-eventstream/";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
                </div>
                <!-- #content -->
            </div>
            <!-- #primary .site-content -->

            <div id="secondary" class="widget-area" role="complementary">
                <aside id="text-5" class="widget widget_text">
                    <h1 class="widget-title">Follow</h1>
                    <div class="textwidget">
                        <a href="http://twitter.com/buildstarted" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://twitter.com']);">Twitter</a><br />
                        <a href="http://stackoverflow.com/users/365526/buildstarted" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://stackoverflow.com']);">Stackoverflow.com</a><br />
                        <a href="https://plus.google.com/118314403854065988234" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://plus.google.com']);">Google+</a><br />
                        <a href="https://github.com/Buildstarted" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://github.com']);">Github</a>
                    </div>
                </aside>
                <aside id="text-8" class="widget widget_text">
                    <h1 class="widget-title">Other sites</h1>
                    <div class="textwidget">
                        <a href="http://typescript.io/" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://typescript.io']);">typescript.io</a><br />
                        <a href="http://csharptube.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://csharptube.com']);">csharptube.com</a><br />
                        <a href="http://thisisparrot.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://thisisparrot.com']);">Parrot</a><br />
                    </div>
                </aside>
                <aside id="linkcat-6" class="widget widget_links">
                    <h1 class="widget-title">Other Blogs</h1>
                    <ul class='xoxo blogroll'>
                        <li><a href="http://blog.andrewnurse.net/" target="_top" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://blog.andrewnurse.net/']);">Andrew Nurse @ Microsoft</a></li>
                        <li><a href="http://weblogs.asp.net/jgalloway/" target="_top" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://weblogs.asp.net/jgalloway/']);">Jon Galloway @ Microsoft</a></li>
                        <li><a href="http://msmvps.com/blogs/jon_skeet/" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://msmvps.com/blogs/jon_skeet/']);">Jon Skeet</a></li>
                        <li><a href="http://invalidcast.com" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://invalidcast.com']);">Martin Rue</a></li>
                        <li><a href="http://haacked.com/" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://haacked.com/']);">Phil Haack @ Github</a></li>

                    </ul>
                </aside>
                <aside id="archives-4" class="widget widget_archive">
                    <h1 class="widget-title">Archive</h1>
                    
                    

                      <ul class="posts">
                        
                          
                          <!-- May placeholder -->
                          
                            
                            <li><a href='../../../../archive.html#2015May'>May 2015</a></li>
                          
                        
                          
                          <!-- December May -->
                          
                            
                            <li><a href='../../../../archive.html#2014December'>December 2014</a></li>
                          
                        
                          
                          <!-- December December -->
                          
                        
                          
                          <!-- June December -->
                          
                            
                            <li><a href='../../../../archive.html#2014June'>June 2014</a></li>
                          
                        
                          
                          <!-- May June -->
                          
                            
                            <li><a href='../../../../archive.html#2014May'>May 2014</a></li>
                          
                        
                          
                          <!-- January May -->
                          
                            
                            <li><a href='../../../../archive.html#2014January'>January 2014</a></li>
                          
                        
                          
                          <!-- January January -->
                          
                        
                          
                          <!-- December January -->
                          
                            
                            <li><a href='../../../../archive.html#2013December'>December 2013</a></li>
                          
                        
                          
                          <!-- December December -->
                          
                        
                          
                          <!-- June December -->
                          
                            
                            <li><a href='../../../../archive.html#2013June'>June 2013</a></li>
                          
                        
                          
                          <!-- June June -->
                          
                        
                          
                          <!-- May June -->
                          
                            
                            <li><a href='../../../../archive.html#2013May'>May 2013</a></li>
                          
                        
                          
                          <!-- February May -->
                          
                            
                            <li><a href='../../../../archive.html#2013February'>February 2013</a></li>
                          
                        
                          
                          <!-- November February -->
                          
                            
                            <li><a href='../../../../archive.html#2012November'>November 2012</a></li>
                          
                        
                          
                          <!-- September November -->
                          
                            
                            <li><a href='../../../../archive.html#2012September'>September 2012</a></li>
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- August September -->
                          
                            
                            <li><a href='../../../../archive.html#2012August'>August 2012</a></li>
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- July August -->
                          
                            
                            <li><a href='../../../../archive.html#2012July'>July 2012</a></li>
                          
                        
                          
                          <!-- July July -->
                          
                        
                          
                          <!-- June July -->
                          
                            
                            <li><a href='../../../../archive.html#2012June'>June 2012</a></li>
                          
                        
                          
                          <!-- May June -->
                          
                            
                            <li><a href='../../../../archive.html#2012May'>May 2012</a></li>
                          
                        
                          
                          <!-- February May -->
                          
                            
                            <li><a href='../../../../archive.html#2012February'>February 2012</a></li>
                          
                        
                          
                          <!-- January February -->
                          
                            
                            <li><a href='../../../../archive.html#2012January'>January 2012</a></li>
                          
                        
                          
                          <!-- January January -->
                          
                        
                          
                          <!-- December January -->
                          
                            
                            <li><a href='../../../../archive.html#2011December'>December 2011</a></li>
                          
                        
                          
                          <!-- December December -->
                          
                        
                          
                          <!-- December December -->
                          
                        
                          
                          <!-- October December -->
                          
                            
                            <li><a href='../../../../archive.html#2011October'>October 2011</a></li>
                          
                        
                          
                          <!-- August October -->
                          
                            
                            <li><a href='../../../../archive.html#2011August'>August 2011</a></li>
                          
                        
                          
                          <!-- July August -->
                          
                            
                            <li><a href='../../../../archive.html#2011July'>July 2011</a></li>
                          
                        
                          
                          <!-- July July -->
                          
                        
                          
                          <!-- June July -->
                          
                            
                            <li><a href='../../../../archive.html#2011June'>June 2011</a></li>
                          
                        
                          
                          <!-- March June -->
                          
                            
                            <li><a href='../../../../archive.html#2011March'>March 2011</a></li>
                          
                        
                          
                          <!-- January March -->
                          
                            
                            <li><a href='../../../../archive.html#2011January'>January 2011</a></li>
                          
                        
                          
                          <!-- January January -->
                          
                        
                          
                          <!-- December January -->
                          
                            
                            <li><a href='../../../../archive.html#2010December'>December 2010</a></li>
                          
                        
                          
                          <!-- November December -->
                          
                            
                            <li><a href='../../../../archive.html#2010November'>November 2010</a></li>
                          
                        
                          
                          <!-- November November -->
                          
                        
                          
                          <!-- November November -->
                          
                        
                          
                          <!-- November November -->
                          
                        
                          
                          <!-- November November -->
                          
                        
                          
                          <!-- November November -->
                          
                        
                          
                          <!-- October November -->
                          
                            
                            <li><a href='../../../../archive.html#2010October'>October 2010</a></li>
                          
                        
                          
                          <!-- October October -->
                          
                        
                          
                          <!-- September October -->
                          
                            
                            <li><a href='../../../../archive.html#2010September'>September 2010</a></li>
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- September September -->
                          
                        
                          
                          <!-- August September -->
                          
                            
                            <li><a href='../../../../archive.html#2010August'>August 2010</a></li>
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                          
                          <!-- August August -->
                          
                        
                      </ul>
                </aside>
            </div>
            <!-- #secondary .widget-area -->


        </div>
        <!-- #main -->

        <footer id="colophon" class="site-footer" role="contentinfo">
            <div class="site-info">
                Powered by <a href="https://github.com/" rel="generator">Github</a><span class="sep"> | </span>Theme: Publish by <a href="http://kovshenin.com/" rel="designer">Konstantin Kovshenin</a>.	
            </div>
            <!-- .site-info -->
        </footer>
        <!-- #colophon .site-footer -->
    </div>
    <!-- #page .hfeed .site -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src='../../../../javascripts/prettify.js' type='text/javascript'></script>
    <script type='text/javascript'>
        $(function () {
            $("pre code").parent().each(function () {
                if (!$(this).hasClass("prettyprint")) {
                    $(this).addClass("prettyprint");
                    a = true
                }
            });

            prettyPrint();
        });
    </script>
</body>
</html>
